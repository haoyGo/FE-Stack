### 浏览器任务调度
调度规则
1. 每次事件循环处理一个宏任务
2. 每个宏任务执行后立即清空微任务队列
3. 渲染阶段在微任务之后、下一个宏任务之前执行
4. 连续嵌套的微任务会阻塞主线程直到队列清空

```javascript
// 执行顺序示例
console.log('script start'); // 同步任务

setTimeout(() => {
  console.log('setTimeout'); // 宏任务
}, 0);

Promise.resolve()
  .then(() => {
    console.log('promise1'); // 微任务
  })
  .then(() => {
    console.log('promise2'); // 微任务
  });

requestAnimationFrame(() => {
  console.log('rAF'); // 特殊渲染阶段任务
});

console.log('script end');

/* 输出顺序：
script start
script end
promise1
promise2 
rAF
setTimeout
*/
```

``` js
// 微任务嵌套
function microtaskLoop() {
  Promise.resolve().then(() => {
    console.log('microtask');
    microtaskLoop();
  });
}
// 会持续执行微任务导致页面卡死
```